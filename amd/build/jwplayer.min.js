define(["jwplayer","jquery","core/config","core/yui","core/log"],function(a,b,c,d,e){var f=null,g=function(a){var b=this,g={method:"POST",data:{sesskey:c.sesskey,event:JSON.stringify(a),id:f,title:b.getPlaylistItem().title,file:b.getPlaylistItem().file,position:b.getPosition(),bitrate:b.getCurrentQuality().bitrate},on:{failure:function(a){e.error(a)}}};"play"==a.type&&setTimeout(function(){g.data.position=b.getPosition()},10),"levelsChanged"==a.type&&(g.data.qualitylevel=JSON.stringify(b.getQualityLevels())),"audioTrackChanged"==a.type&&(g.data.audiotracks=JSON.stringify(b.getAudioTracks())),"captionsChanged"==a.type&&(g.data.captions=JSON.stringify(b.getCaptionsList())),d.io(c.wwwroot+"/filter/jwplayer/eventlogger.php",g)},h=function(a){var b=this.getPlaylistItem().title+" "+a.type+": "+a.message;e.error(b)};return{init:function(b){window.jwplayer=window.jwplayer||a,b&&(window.jwplayer.key=b)},setupPlayer:function(c){if(f=c.logcontext,b("#"+c.playerid).length){var d=a(c.playerid);d.setup(c.setupdata),"undefined"!=typeof c.downloadbtn&&d.addButton(c.downloadbtn.img,c.downloadbtn.tttext,function(){window.open(d.getPlaylistItem().file+"?forcedownload=true")},"download"),d.on("setupError",h),d.on("error",h),c.logevents.forEach(function(a){d.on(a,g)})}}}});